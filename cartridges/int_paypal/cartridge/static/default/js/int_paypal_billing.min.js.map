{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./cartridges/int_paypal/cartridge/client/default/js/api.js","webpack:///./cartridges/int_paypal/cartridge/client/default/js/billing/billing.js","webpack:///./cartridges/int_paypal/cartridge/client/default/js/billing/billingHelper.js","webpack:///./cartridges/int_paypal/cartridge/client/default/js/billing/guest/initBillingButton.js","webpack:///./cartridges/int_paypal/cartridge/client/default/js/billing/registered/billingAgreementHelper.js","webpack:///./cartridges/int_paypal/cartridge/client/default/js/billing/registered/initBillingAgreementButton.js","webpack:///./cartridges/int_paypal/cartridge/client/default/js/helper.js","webpack:///./cartridges/int_paypal/cartridge/client/default/js/loader.js"],"names":["loaderInstance","require","$loaderContainer","document","querySelector","loader","showCartErrorHtml","message","$","addClass","append","window","scrollTo","showCheckoutErrorHtml","textContent","style","display","updateOrderData","show","ajax","url","paypalUrls","type","success","hide","location","href","placeOrderStage","error","err","JSON","parse","responseText","errorMsg","transactionExpired","reload","getPurchaseUnits","get","getPurchaseUnit","then","purchase_units","getBillingAgreementToken","isCartFlow","createBillingAgreementToken","data","createBillingAgreementCall","billingToken","createBillingAgreement","contentType","stringify","createCartBillingFormData","fieldsData","$paypalButton","cartBillingFormData","FormData","cartBillingFields","getAttribute","Object","entries","forEach","entry","key","field","name","value","returnFromCart","processData","finishLpmOrder","details","lpmName","paypalMethodId","sdkLoaded","$restPaypalAccountsList","isRegisteredUser","$billingButtonContainer","isBAEnabled","paypal","initPaypalButton","isNewAccountSelected","initPaypalBAButton","ppPaymentOptionID","parentElement","activeTab","click","setAttribute","togglePaypalBtnVisibility","toggleBABtnVisibility","assignEmailForSavedBA","on","handleTabChange","onchange","e","$accountList","target","injectBillingSDK","updateSessionAccountEmail","updateClientSide","updateSubmitOrderButton","onclick","innerText","querySelectorAll","checkbox","addEventListener","handleCheckboxChange","$paypalAccountsDropdown","$continueButton","showContinueButton","hideContinueButton","showPaypalBtn","hidePaypalBtn","showPaypalBlock","hidePaypalBlock","head","getElementsByTagName","item","script","createElement","onload","src","billingSdkUrl","partnerAttributionId","appendChild","isPaypalContentSelected","hash","_","paypalPayerEmail","order","$sessionPaypalAccount","selected","customer","selectedPaymentInstruments","billing","payment","paypalPaymentMethod","giftCertTabLink","length","paymentInstr","paymentMethod","clearSessionOption","$defaultBA","find","isLpmUsed","$usedPaymentMethod","disableFunds","indexOf","regExpPhone","RegExp","regExpEmail","notEmptyString","filterValidFormElement","str","test","parseBillingFields","acc","split","inputValue","decodeURIComponent","validInput","createBillingAddress","serialize","filter","reduce","createPayerObject","billingAddress","country","phone","given_name","firstName","surname","lastName","email_address","email","phone_number","national_number","address","address_line_1","address1","address_line_2","address2","admin_area_2","city","admin_area_1","stateCode","postal_code","postalCode","country_code","onClick","fundingSource","createOrder","actions","parsedPurchaseUnit","amount","payer","payerObj","application_context","shipping_preference","create","onApprove","capture","redirectUrl","processLpmConfirmForm","catch","$orderId","$selectedAccount","orderID","onCancel","onError","Buttons","getPaypalButtonStyle","render","$billingBAbutton","$paypalAccountSave","$paypalAccountMakeDefault","setBAFormValues","baID","baEmail","getElementById","showPaypalBABtn","hidePaypalBABtn","saveCheckboxState","$paypal_makeDefault","$paypal_saveAccount","checked","isSessionAccountAppended","hasDefaultPaymentMethod","disabled","toggleCustomCheckbox","$paypalAccountMakeDefaultContainer","$paypalAccountSaveContainer","hasPPSavedAccount","isBALimitReached","dataset","default","isDataSetDefault","$paypalActiveAccount","baId","$option","text","updateSessionOption","token","fail","id","payerInfo","payer_info","billing_address","billingAddressFields","contactInfoFields","slice","call","keysValues","phoneNumber","billingFirstName","first_name","billingLastName","last_name","billingAddressOne","line1","billingCountry","billingState","state","billingAddressCity","billingZipCode","$billinAddressBlock","concat","el","trim","sameAttribute","options","defaultStyle","color","shape","layout","label","tagline","button","config","buttonConfigs","createConfirmForm","param","form","appendTo","body","attr","method","action","orderToken","splitUrl","paramsString","searchParams","URLSearchParams","formParam","submit","module","exports","containerElement","Constructor","containerEl","prototype"],"mappings":"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","file":"int_paypal_billing.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./cartridges/int_paypal/cartridge/client/default/js/billing/billing.js\");\n","var loaderInstance = require('./loader');\r\nvar $loaderContainer = document.querySelector('.paypalLoader');\r\nvar loader = loaderInstance($loaderContainer);\r\n/**\r\n *  Appends error message on cart page\r\n *\r\n * @param {string} message error message\r\n */\r\nfunction showCartErrorHtml(message) {\r\n    $('.checkout-btn').addClass('disabled');\r\n    $('.cart-error').append(\r\n        `<div class=\"alert alert-danger alert-dismissible valid-cart-error fade show cartError\" role=\"alert\">\r\n            <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">\r\n                <span aria-hidden=\"true\">&times;</span>\r\n            </button>\r\n            ${message}\r\n        </div>`\r\n    );\r\n    window.scrollTo(0, 0);\r\n}\r\n\r\n/**\r\n *  Appends error message on billing checkout page\r\n *\r\n * @param {string} message error message\r\n */\r\nfunction showCheckoutErrorHtml(message) {\r\n    document.querySelector('.error-message-text').textContent = '';\r\n    document.querySelector('.error-message').style.display = 'block';\r\n    document.querySelector('.error-message-text').append(message);\r\n    window.scrollTo(0, 0);\r\n}\r\n\r\n/**\r\n * Updates information about an order\r\n *\r\n * @returns {Object} Call handling result\r\n */\r\nfunction updateOrderData() {\r\n    loader.show();\r\n    return $.ajax({\r\n        url: window.paypalUrls.updateOrderData + '?isCartFlow=true',\r\n        type: 'PATCH',\r\n        success: () => {\r\n            loader.hide();\r\n            window.location.href = window.paypalUrls.placeOrderStage;\r\n        },\r\n        error: (err) => {\r\n            loader.hide();\r\n            var error = JSON.parse(err.responseText);\r\n            showCartErrorHtml(error.errorMsg);\r\n            if (error.transactionExpired) {\r\n                location.reload();\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Gets purchase units\r\n *\r\n * @returns {Object} with purchase units data\r\n */\r\nfunction getPurchaseUnits() {\r\n    return $.get(window.paypalUrls.getPurchaseUnit)\r\n        .then(({ purchase_units }) => purchase_units);\r\n}\r\n\r\n/**\r\n * Gets Billing Agreement Token\r\n *\r\n * @param {boolean} isCartFlow - billing agreement flow from cart\r\n * @returns {string} billingToken - returns a JSON response that includes token, an approval URL\r\n */\r\nfunction getBillingAgreementToken(isCartFlow = false) {\r\n    return $.get(window.paypalUrls.createBillingAgreementToken + `?isCartFlow=${isCartFlow}`)\r\n        .then((data) => data);\r\n}\r\n\r\n/**\r\n * Gets Billing Agreement\r\n * After buyer approval, you use a billing agreement token to create the agreement.\r\n *\r\n * @param {string} billingToken - billing agreement token\r\n * @returns {Object} JSON response body that includes the billing agreement ID,\r\n * the state of the agreement, which is ACTIVE, and information about the payer\r\n */\r\nfunction createBillingAgreementCall(billingToken) {\r\n    return $.ajax({\r\n        url: window.paypalUrls.createBillingAgreement,\r\n        type: 'POST',\r\n        contentType: 'application/json',\r\n        data: JSON.stringify({ billingToken })\r\n    });\r\n}\r\n\r\n/**\r\n * Create billing formData from fields data\r\n *\r\n * @param {Object} fieldsData - fields data values\r\n * @param {Elemtn} $paypalButton - paypal button selector\r\n * @returns {Object} cart billing form data\r\n */\r\nfunction createCartBillingFormData(fieldsData, $paypalButton) {\r\n    var cartBillingFormData = new FormData();\r\n    if (!$paypalButton) {\r\n        $paypalButton = document.querySelector('#paypal_pdp_image') || document.querySelector('#paypal_image') || document.querySelector('#venmo_image');\r\n    }\r\n    var cartBillingFields = $paypalButton && JSON.parse($paypalButton.getAttribute('data-paypal-billing-form-fields'));\r\n\r\n    Object.entries(cartBillingFields).forEach(entry => {\r\n        const [key, field] = entry;\r\n        if (typeof field === 'object') {\r\n            cartBillingFormData.append(field.name, fieldsData && fieldsData[key] ? fieldsData[key] : field.value);\r\n        }\r\n    });\r\n\r\n    return cartBillingFormData;\r\n}\r\n\r\n/**\r\n * Calls to returnFromCart endpoint, redirects to place order stage or shows error if it exists\r\n *\r\n * @returns {Object} Call handling result\r\n */\r\nfunction returnFromCart() {\r\n    loader.show();\r\n    let cartBillingFormData = createCartBillingFormData();\r\n\r\n    return $.ajax({\r\n        url: window.paypalUrls.returnFromCart,\r\n        type: 'POST',\r\n        contentType: false,\r\n        data: cartBillingFormData,\r\n        processData: false,\r\n        success: () => {\r\n            loader.hide();\r\n            window.location.href = window.paypalUrls.placeOrderStage;\r\n        },\r\n        error: function (err) {\r\n            loader.hide();\r\n            showCartErrorHtml(err.responseText);\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Call finishLpmOrder endpoint\r\n * @param  {Object} details billing address details\r\n * @returns {Promise} ajax call\r\n */\r\nfunction finishLpmOrder(details) {\r\n    const lpmName = document.querySelector('#usedPaymentMethod').value;\r\n    const paypalMethodId = document.querySelector('#paypalMethodId').value;\r\n    return $.ajax({\r\n        url: window.paypalUrls.finishLpmOrder,\r\n        type: 'POST',\r\n        contentType: 'application/json',\r\n        data: JSON.stringify({\r\n            details,\r\n            lpmName,\r\n            paypalMethodId\r\n        })\r\n    });\r\n}\r\n\r\nexport {\r\n    updateOrderData,\r\n    getPurchaseUnits,\r\n    getBillingAgreementToken,\r\n    createBillingAgreementCall,\r\n    returnFromCart,\r\n    showCartErrorHtml,\r\n    showCheckoutErrorHtml,\r\n    finishLpmOrder,\r\n    createCartBillingFormData\r\n};\r\n","import initPaypalButton from './guest/initBillingButton';\r\nimport initPaypalBAButton from './registered/initBillingAgreementButton';\r\n\r\nimport {\r\n    injectBillingSDK,\r\n    handleTabChange,\r\n    togglePaypalBtnVisibility,\r\n    updateSessionAccountEmail,\r\n    isNewAccountSelected,\r\n    updateClientSide,\r\n    updateSubmitOrderButton\r\n} from './billingHelper';\r\n\r\nimport {\r\n    toggleBABtnVisibility,\r\n    assignEmailForSavedBA,\r\n    handleCheckboxChange\r\n} from './registered/billingAgreementHelper';\r\n\r\nlet sdkLoaded = false;\r\nlet $restPaypalAccountsList = document.querySelector('#restPaypalAccountsList');\r\nlet isRegisteredUser = document.querySelector('.data-checkout-stage').getAttribute('data-customer-type') === 'registered';\r\nlet $billingButtonContainer = document.querySelector('#billing-paypal-button-container');\r\nlet isBAEnabled = $billingButtonContainer && JSON.parse($billingButtonContainer.getAttribute('data-is-ba-enabled'));\r\nconst paypalUrls = document.querySelector('.js_paypal-content').getAttribute('data-paypal-urls');\r\nwindow.paypalUrls = JSON.parse(paypalUrls);\r\n\r\nif (window.paypal && !isBAEnabled) {\r\n    sdkLoaded = true;\r\n    initPaypalButton();\r\n} else {\r\n    if (window.paypal && isNewAccountSelected($restPaypalAccountsList) && isBAEnabled) {\r\n        initPaypalBAButton();\r\n        sdkLoaded = true;\r\n    }\r\n\r\n    let ppPaymentOptionID = document.querySelector('.nav-link.paypal-tab').parentElement.getAttribute('data-method-id');\r\n    let activeTab = document.querySelector('.payment-information');\r\n    document.querySelector('.nav-item .paypal-tab').click();\r\n    if (ppPaymentOptionID !== activeTab.getAttribute('data-payment-method-id')) {\r\n        activeTab.setAttribute('data-payment-method-id', ppPaymentOptionID);\r\n        $('.payment-information').data('payment-method-id', ppPaymentOptionID); // MFRA jquery hack\r\n    }\r\n\r\n    if (!isBAEnabled) {\r\n        togglePaypalBtnVisibility($restPaypalAccountsList);\r\n    } else {\r\n        toggleBABtnVisibility($restPaypalAccountsList);\r\n        assignEmailForSavedBA();\r\n    }\r\n}\r\n\r\n$('.payment-options[role=tablist] a[data-toggle=\"tab\"]').on('shown.bs.tab', handleTabChange);\r\n\r\nif ($restPaypalAccountsList) {\r\n    $restPaypalAccountsList.onchange = function (e) {\r\n        const $accountList = e ? e.target : $restPaypalAccountsList;\r\n        if (!sdkLoaded && isNewAccountSelected($restPaypalAccountsList)) {\r\n            injectBillingSDK();\r\n            sdkLoaded = true;\r\n        }\r\n\r\n        if (!isBAEnabled) {\r\n            togglePaypalBtnVisibility($accountList);\r\n        } else {\r\n            toggleBABtnVisibility($accountList);\r\n            assignEmailForSavedBA();\r\n        }\r\n    };\r\n}\r\n\r\nif (!isRegisteredUser || !isBAEnabled) {\r\n    $('body').on('checkout:updateCheckoutView', updateSessionAccountEmail);\r\n}\r\n\r\n$('body').on('checkout:updateCheckoutView', updateClientSide);\r\n\r\nif (!isBAEnabled) {\r\n    $('body').on('checkout:updateCheckoutView', updateSubmitOrderButton);\r\n\r\n    updateSubmitOrderButton();\r\n\r\n    document.querySelector('.payment-summary .edit-button').onclick = function () {\r\n        document.querySelector('button.place-order').innerText = 'Place Order';\r\n    };\r\n}\r\n\r\nif (document.querySelector('.paypal-checkbox-container')) {\r\n    document.querySelectorAll('.paypal-checkbox-container .custom-checkbox').forEach(checkbox => checkbox.addEventListener('change', handleCheckboxChange));\r\n}\r\n","import initPaypalButton from './guest/initBillingButton';\r\nimport initPaypalBAButton from './registered/initBillingAgreementButton';\r\nimport {\r\n    assignEmailForSavedBA,\r\n    handleCheckboxChange,\r\n    toggleBABtnVisibility,\r\n    clearSessionOption\r\n} from './registered/billingAgreementHelper';\r\n\r\nlet $paypalButton = document.querySelector('.js_paypal_button_on_billing_form');\r\nlet $paypalAccountsDropdown = document.querySelector('#paypalAccountsDropdown');\r\nconst $continueButton = document.querySelector('button[value=submit-payment]');\r\nlet isRegisteredUser = document.querySelector('.data-checkout-stage') && document.querySelector('.data-checkout-stage').getAttribute('data-customer-type') === 'registered';\r\nlet $restPaypalAccountsList = document.querySelector('#restPaypalAccountsList');\r\nlet $billingButtonContainer = document.querySelector('#billing-paypal-button-container');\r\nlet isBAEnabled = $billingButtonContainer && JSON.parse($billingButtonContainer.getAttribute('data-is-ba-enabled'));\r\n\r\n/**\r\n * Shows continue button if it's not visible\r\n */\r\nfunction showContinueButton() {\r\n    if ($continueButton.style.display !== '') {\r\n        $continueButton.style.display = '';\r\n    }\r\n}\r\n\r\n/**\r\n * Hides continue button if it's not hidden\r\n */\r\nfunction hideContinueButton() {\r\n    if ($continueButton.style.display !== 'none') {\r\n        $continueButton.style.display = 'none';\r\n    }\r\n}\r\n\r\n/**\r\n * Shows PayPal div container if it's not visible and hides continue button\r\n*/\r\nfunction showPaypalBtn() {\r\n    if (!$paypalButton) {\r\n        $paypalButton = document.querySelector('.js_paypal_button_on_billing_form');\r\n    }\r\n    if ($paypalButton.style.display !== 'block') {\r\n        $paypalButton.style.display = 'block';\r\n    }\r\n    hideContinueButton();\r\n}\r\n\r\n/**\r\n * Hides PayPal div container if it's not hidden and shows continue button\r\n*/\r\nfunction hidePaypalBtn() {\r\n    if (!$paypalButton) {\r\n        $paypalButton = document.querySelector('.js_paypal_button_on_billing_form');\r\n    }\r\n    if ($paypalButton.style.display !== 'none') {\r\n        $paypalButton.style.display = 'none';\r\n    }\r\n    showContinueButton();\r\n}\r\n\r\n/**\r\n * Shows PayPal block with accounts dropdown if it's not visible\r\n*/\r\nfunction showPaypalBlock() {\r\n    if (!$paypalAccountsDropdown) {\r\n        $paypalAccountsDropdown = document.querySelector('#paypalAccountsDropdown');\r\n    }\r\n    if ($paypalAccountsDropdown.style.display !== 'block') {\r\n        $paypalAccountsDropdown.style.display = 'block';\r\n    }\r\n}\r\n\r\n/**\r\n * Hides PayPal block with accounts dropdown if it's visible\r\n*/\r\nfunction hidePaypalBlock() {\r\n    if (!$paypalAccountsDropdown) {\r\n        $paypalAccountsDropdown = document.querySelector('#paypalAccountsDropdown');\r\n    }\r\n    if ($paypalAccountsDropdown.style.display !== 'none') {\r\n        $paypalAccountsDropdown.style.display = 'none';\r\n    }\r\n}\r\n\r\n/**\r\n * Injects SDK into billing page\r\n*/\r\nfunction injectBillingSDK() {\r\n    var head = document.getElementsByTagName('head').item(0);\r\n    var script = document.createElement('script');\r\n    script.type = 'text/javascript';\r\n    script.onload = function () {\r\n        isBAEnabled ?\r\n            initPaypalBAButton() :\r\n            initPaypalButton();\r\n    };\r\n    script.src = window.paypalUrls.billingSdkUrl;\r\n    script.setAttribute('data-partner-attribution-id', window.paypalUrls.partnerAttributionId);\r\n    head.appendChild(script);\r\n}\r\n\r\n/**\r\n * Shows is new account selected\r\n * @param {Element} $accountList - $accountList element\r\n * @returns {boolean} value whether new account selected\r\n*/\r\nfunction isNewAccountSelected($accountList) {\r\n    return $accountList\r\n        .querySelector('option:checked')\r\n        .value === 'newaccount';\r\n}\r\n\r\n/**\r\n * Changes PayPal button visibility depending on checked option of element\r\n * @param {Element} $accountList - $accountList element\r\n*/\r\nfunction togglePaypalBtnVisibility($accountList) {\r\n    isNewAccountSelected($accountList) ?\r\n        showPaypalBtn() :\r\n        hidePaypalBtn();\r\n}\r\n\r\n/**\r\n * Handles tabs changing\r\n * @param {event} e - event\r\n*/\r\nfunction handleTabChange(e) {\r\n    const isPaypalContentSelected = e.target.hash === '#paypal-content';\r\n    if (!isPaypalContentSelected) {\r\n        showContinueButton();\r\n        return;\r\n    }\r\n    isNewAccountSelected($restPaypalAccountsList) ?\r\n        hideContinueButton() :\r\n        showContinueButton();\r\n    if (isRegisteredUser && isBAEnabled) {\r\n        assignEmailForSavedBA();\r\n        handleCheckboxChange();\r\n    }\r\n}\r\n\r\n/**\r\n * Updates session account email if it is differ from existed or email doesn't exist (for guest or disabled billing agreement)\r\n * @param {Object} _ - arg\r\n *\r\n*/\r\nfunction updateSessionAccountEmail(_, { order: { paypalPayerEmail } }) {\r\n    if (!paypalPayerEmail) return;\r\n    showPaypalBlock();\r\n    const $sessionPaypalAccount = document.querySelector('#sessionPaypalAccount');\r\n    if ($sessionPaypalAccount && $sessionPaypalAccount.value !== paypalPayerEmail) {\r\n        $sessionPaypalAccount.value = paypalPayerEmail;\r\n        $sessionPaypalAccount.innerText = paypalPayerEmail;\r\n        $sessionPaypalAccount.selected = true;\r\n        $restPaypalAccountsList.onchange();\r\n    }\r\n}\r\n\r\n/**\r\n * Updates paypal content to initial state on client side if payment method was changed from paypal to different one\r\n * @param {Object} _ - arg\r\n * @param {Object} customer - customer data object\r\n*/\r\nfunction updateClientSide(_, customer) {\r\n    var selectedPaymentInstruments = customer.order.billing.payment.selectedPaymentInstruments;\r\n    var paypalPaymentMethod = document.querySelector('.nav-link.paypal-tab').parentElement.getAttribute('data-method-id');\r\n    var giftCertTabLink = document.querySelector('.nav-link.gift-cert-tab');\r\n    var $sessionPaypalAccount = $restPaypalAccountsList.querySelector('option[id=sessionPaypalAccount]');\r\n\r\n    if (selectedPaymentInstruments.length > 0 && ($sessionPaypalAccount && $sessionPaypalAccount.value !== '')) {\r\n        selectedPaymentInstruments.forEach(paymentInstr => {\r\n            if (paymentInstr.paymentMethod !== paypalPaymentMethod) {\r\n                if (!isBAEnabled) {\r\n                    $sessionPaypalAccount.value = '';\r\n                    $restPaypalAccountsList.querySelector('option:checked').value = 'newaccount';\r\n                    document.querySelector('#usedPaymentMethod').value = '';\r\n                    hidePaypalBlock();\r\n                    togglePaypalBtnVisibility($restPaypalAccountsList);\r\n                } else if (isBAEnabled && $sessionPaypalAccount) {\r\n                    clearSessionOption();\r\n                    var $defaultBA = $restPaypalAccountsList.querySelector('option[data-default=true]');\r\n                    $defaultBA ? $defaultBA.selected = true : hidePaypalBlock();\r\n                    toggleBABtnVisibility();\r\n                }\r\n                injectBillingSDK();\r\n            }\r\n        });\r\n    } else if (selectedPaymentInstruments.length > 0 && giftCertTabLink) {\r\n        if (selectedPaymentInstruments.find(paymentInstr => paymentInstr.paymentMethod === giftCertTabLink.parentElement.getAttribute('data-method-id'))) {\r\n            giftCertTabLink.click();\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Returns value whether LPM was used or not\r\n * @param {Element} $usedPaymentMethod - $usedPaymentMethod element\r\n * @returns {boolean} value whether LPM was used\r\n*/\r\nfunction isLpmUsed($usedPaymentMethod) {\r\n    const disableFunds = [\r\n        'sepa',\r\n        'bancontact',\r\n        'eps',\r\n        'giropay',\r\n        'ideal',\r\n        'mybank',\r\n        'p24',\r\n        'sofort'\r\n    ];\r\n    if (disableFunds.indexOf($usedPaymentMethod.value) !== -1) {\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * Updates \"Submit order\" button text on billing page in case of Venmo checkout\r\n * Needed in case of checkout NOT through smart button (when Venmo account is chosen in dropdown)\r\n*/\r\nfunction updateSubmitOrderButton() {\r\n    var $usedPaymentMethod = document.querySelector('#usedPaymentMethod');\r\n    if ($usedPaymentMethod && $usedPaymentMethod.value === 'Venmo') {\r\n        document.querySelector('button.place-order').innerText = 'Place Order with Venmo';\r\n    }\r\n}\r\n\r\nexport {\r\n    injectBillingSDK,\r\n    showPaypalBlock,\r\n    showPaypalBtn,\r\n    hidePaypalBtn,\r\n    hideContinueButton,\r\n    handleTabChange,\r\n    togglePaypalBtnVisibility,\r\n    updateSessionAccountEmail,\r\n    isNewAccountSelected,\r\n    updateClientSide,\r\n    showContinueButton,\r\n    isLpmUsed,\r\n    updateSubmitOrderButton\r\n};\r\n","/* eslint-disable no-useless-escape */\r\n/* eslint-disable no-control-regex */\r\nimport { getPurchaseUnits, showCheckoutErrorHtml, finishLpmOrder } from '../../api';\r\nimport { isLpmUsed } from '../billingHelper';\r\nimport { getPaypalButtonStyle, processLpmConfirmForm } from '../../helper';\r\n\r\nconst loaderInstance = require('../../loader');\r\nlet $loaderContainer = document.querySelector('.paypalLoader');\r\nlet loader = loaderInstance($loaderContainer);\r\nlet $usedPaymentMethod = document.querySelector('#usedPaymentMethod');\r\nconst regExpPhone = new RegExp(/^[0-9]{1,14}?$/);\r\nconst regExpEmail = new RegExp(/(?:[a-zA-Z0-9!#$%&'*+\\/=?^_`{|}~-]+(?:\\.[a-zA-Z0-9!#$%&'*+\\/=?^_`{|}~-]+)*|(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\x7f]|\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*\")@(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\\.)+[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?|\\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-zA-Z0-9-]*[a-zA-Z0-9]:(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21-\\x5a\\x53-\\x7f]|\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)\\])/);\r\nconst notEmptyString = new RegExp(/=(?!\\s*$).+/);\r\n\r\n/**\r\n *  Filters valid form elements\r\n *\r\n * @param {string} str - arg\r\n * @returns {string} with valid form element\r\n */\r\nfunction filterValidFormElement(str) {\r\n    return (str.indexOf('addressFields') !== -1 || str.indexOf('contactInfoFields') !== -1)\r\n        && notEmptyString.test(str);\r\n}\r\n\r\n/**\r\n *  Parses billing fields\r\n *\r\n * @param {string} acc -\r\n * @param {string} str - paypal actions\r\n * @returns {string} decoded string\r\n */\r\nfunction parseBillingFields(acc, str) {\r\n    let [key, value] = str.split('=');\r\n    key = key.split('_');\r\n    key = key[key.length - 1];\r\n    const inputValue = decodeURIComponent(value);\r\n    if (key === 'phone' || key === 'email') {\r\n        let validInput = (key === 'phone') ?\r\n            regExpPhone.test(inputValue) :\r\n            regExpEmail.test(inputValue);\r\n        if (!validInput) return acc;\r\n    }\r\n    acc[key] = inputValue;\r\n    return acc;\r\n}\r\n\r\n/**\r\n *  Creates billing address, serializes address into form\r\n *\r\n * @returns {Object} with created billing address\r\n */\r\nfunction createBillingAddress() {\r\n    return $('#dwfrm_billing')\r\n        .serialize()\r\n        .split('&')\r\n        .filter(filterValidFormElement)\r\n        .reduce(parseBillingFields, {});\r\n}\r\n\r\n/**\r\n *  Creates payer object with billing address data\r\n *\r\n * @param {Object} billingAddress - billing address\r\n * @returns {Object} with payer data\r\n */\r\nfunction createPayerObject(billingAddress) {\r\n    if (billingAddress.country && billingAddress.phone) {\r\n        return {\r\n            name: {\r\n                given_name: billingAddress.firstName,\r\n                surname: billingAddress.lastName\r\n            },\r\n            email_address: billingAddress.email,\r\n            phone: {\r\n                phone_number: {\r\n                    national_number: billingAddress.phone\r\n                }\r\n            },\r\n            address: {\r\n                address_line_1: billingAddress.address1,\r\n                address_line_2: billingAddress.address2 || '',\r\n                admin_area_2: billingAddress.city,\r\n                admin_area_1: billingAddress.stateCode,\r\n                postal_code: billingAddress.postalCode,\r\n                country_code: billingAddress.country\r\n            }\r\n        };\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * Saves used payment method to hidden input\r\n *\r\n * @param {Object} data - object with data\r\n */\r\nfunction onClick(data) {\r\n    $usedPaymentMethod.value = data.fundingSource;\r\n}\r\n/**\r\n *  Gets purchase units object, creates order and returns object with data\r\n *\r\n * @param {Object} _ - arg\r\n * @param {Object} actions - paypal actions\r\n * @returns {Object} with purchase units, payer and application context\r\n */\r\nfunction createOrder(_, actions) {\r\n    loader.show();\r\n    return getPurchaseUnits()\r\n        .then(purchase_units => {\r\n            let parsedPurchaseUnit = purchase_units[0];\r\n            if (JSON.parse(parsedPurchaseUnit.amount.value) === 0) {\r\n                showCheckoutErrorHtml('Order total 0 is not allowed for PayPal');\r\n            }\r\n            var payer;\r\n            const payerObj = createPayerObject(createBillingAddress());\r\n            if (payerObj) {\r\n                payer = payerObj;\r\n            }\r\n            const application_context = {\r\n                shipping_preference: parsedPurchaseUnit.shipping_preference\r\n            };\r\n            loader.hide();\r\n            return actions.order.create({\r\n                purchase_units,\r\n                payer,\r\n                application_context\r\n            });\r\n        });\r\n}\r\n\r\n/**\r\n * Sets orderID to hidden input, clears session account if it exists and irrelevant errors,\r\n * and clicks submit payment button\r\n *\r\n * @param {Object} data - object with data\r\n * @param {Object} actions - actions\r\n *\r\n */\r\nfunction onApprove(data, actions) {\r\n    loader.show();\r\n\r\n    if (isLpmUsed($usedPaymentMethod)) {\r\n        actions.order.capture()\r\n            .then(finishLpmOrder)\r\n            .then(({ redirectUrl }) => {\r\n                loader.hide();\r\n                processLpmConfirmForm(redirectUrl);\r\n            })\r\n            .catch(function () {\r\n                loader.hide();\r\n            });\r\n        return;\r\n    }\r\n\r\n    var $orderId = document.querySelector('#paypal_orderId');\r\n    var $selectedAccount = document.querySelector('#sessionPaypalAccount');\r\n\r\n    if ($usedPaymentMethod.value === 'venmo') {\r\n        $usedPaymentMethod.value = 'Venmo';\r\n        document.querySelector('button.place-order').innerText = 'Place Order with Venmo';\r\n    }\r\n\r\n    $orderId.value = data.orderID;\r\n\r\n    if ($selectedAccount.value !== '') {\r\n        $selectedAccount.value = '';\r\n        $selectedAccount.innerText = '';\r\n    }\r\n\r\n    $selectedAccount.selected = true;\r\n    $selectedAccount.style.display = 'block';\r\n\r\n    document.querySelector('button.submit-payment').click();\r\n    loader.hide();\r\n}\r\n\r\n/**\r\n * Hides loader on paypal widget closing without errors\r\n *\r\n */\r\nfunction onCancel() {\r\n    loader.hide();\r\n}\r\n\r\n/**\r\n * Shows errors if paypal widget was closed with errors\r\n *\r\n */\r\nfunction onError() {\r\n    loader.hide();\r\n    if (document.querySelector('.error-message').style.display !== 'block') {\r\n        showCheckoutErrorHtml('An internal server error has occurred. \\r\\nRetry the request later.');\r\n    }\r\n}\r\n\r\n/**\r\n *Inits paypal button on billing checkout page\r\n */\r\nfunction initPaypalButton() {\r\n    loader.show();\r\n    window.paypal.Buttons({\r\n        onClick,\r\n        createOrder,\r\n        onApprove,\r\n        onCancel,\r\n        onError,\r\n        style: getPaypalButtonStyle(document.querySelector('.js_paypal_button_on_billing_form'))\r\n    }).render('.paypal-checkout-button')\r\n        .then(() => {\r\n            loader.hide();\r\n        });\r\n}\r\n\r\nexport default initPaypalButton;\r\n","import {\r\n    hideContinueButton,\r\n    isNewAccountSelected,\r\n    showContinueButton,\r\n    showPaypalBlock\r\n} from '../billingHelper';\r\n\r\nlet $billingBAbutton = document.querySelector('.paypal-checkout-ba-button');\r\nlet $restPaypalAccountsList = document.querySelector('#restPaypalAccountsList');\r\nlet $paypalAccountSave = document.querySelector('#savePaypalAccount');\r\nlet $paypalAccountMakeDefault = document.querySelector('#paypalAccountMakeDefault');\r\n\r\n/**\r\n * Sets BA id & email to form values\r\n * @param {string} baID - billing agreement active ID\r\n * @param {string} baEmail - billing agreement active email\r\n*/\r\nfunction setBAFormValues(baID, baEmail) {\r\n    document.getElementById('billingAgreementID').value = baID;\r\n    document.getElementById('billingAgreementPayerEmail').value = baEmail;\r\n}\r\n\r\n/** Shows PayPal BA button if it's not visible and hides continue button\r\n*/\r\nfunction showPaypalBABtn() {\r\n    if (!$billingBAbutton) {\r\n        $billingBAbutton = document.querySelector('.paypal-checkout-ba-button');\r\n    }\r\n    if ($billingBAbutton.style.display !== 'block') {\r\n        $billingBAbutton.style.display = 'block';\r\n    }\r\n    hideContinueButton();\r\n}\r\n\r\n/** Hides PayPal BA button if it's not hidden and shows continue button\r\n*/\r\nfunction hidePaypalBABtn() {\r\n    if (!$billingBAbutton) {\r\n        $billingBAbutton = document.querySelector('.paypal-checkout-ba-button');\r\n    }\r\n    if ($billingBAbutton.style.display !== 'none') {\r\n        $billingBAbutton.style.display = 'none';\r\n    }\r\n    showContinueButton();\r\n}\r\n\r\n/** Put value of checkbox makeDefault/saveAccount for backend\r\n*/\r\nfunction saveCheckboxState() {\r\n    var $paypal_makeDefault = document.querySelector('#paypal_makeDefault');\r\n    var $paypal_saveAccount = document.querySelector('#paypal_saveAccount');\r\n    $paypal_makeDefault.value = $paypalAccountMakeDefault.checked;\r\n    $paypal_saveAccount.value = $paypalAccountSave.checked;\r\n}\r\n\r\n/** Handle makeDefault/saveAccount checkboxes state on change\r\n*/\r\nfunction handleCheckboxChange() {\r\n    let $selectedAccount = $restPaypalAccountsList.querySelector('option:checked');\r\n    let isSessionAccountAppended = JSON.parse($selectedAccount.getAttribute('data-append'));\r\n    let hasDefaultPaymentMethod = JSON.parse($restPaypalAccountsList.getAttribute('data-has-default-account'));\r\n\r\n    if (isSessionAccountAppended || $selectedAccount.value === 'newaccount') {\r\n        if (!$paypalAccountSave.checked) {\r\n            $paypalAccountMakeDefault.checked = false;\r\n            $paypalAccountMakeDefault.disabled = true;\r\n        } else {\r\n            $paypalAccountMakeDefault.disabled = false;\r\n            if (!hasDefaultPaymentMethod) {\r\n                $paypalAccountMakeDefault.checked = true;\r\n            }\r\n        }\r\n    }\r\n    saveCheckboxState();\r\n}\r\n\r\n/** Show/hide/check/disable checkboxes depends on selected type of account\r\n*/\r\nfunction toggleCustomCheckbox() {\r\n    let $selectedAccount = $restPaypalAccountsList.querySelector('option:checked');\r\n    let $paypalAccountMakeDefaultContainer = document.querySelector('#paypalAccountMakeDefaultContainer');\r\n    let $paypalAccountSaveContainer = document.querySelector('#savePaypalAccountContainer');\r\n    let hasPPSavedAccount = JSON.parse($restPaypalAccountsList.getAttribute('data-has-saved-account'));\r\n    let hasDefaultPaymentMethod = JSON.parse($restPaypalAccountsList.getAttribute('data-has-default-account'));\r\n    let isSessionAccountAppended = JSON.parse($selectedAccount.getAttribute('data-append'));\r\n    let isBALimitReached = JSON.parse($restPaypalAccountsList.getAttribute('data-ba-limit-reached'));\r\n\r\n    if ($paypalAccountSaveContainer) {\r\n        if ($selectedAccount.dataset.default === 'true') {\r\n            $paypalAccountMakeDefaultContainer.style.display = 'none';\r\n            $paypalAccountMakeDefault.checked = true;\r\n            $paypalAccountMakeDefault.disabled = false;\r\n            if (hasPPSavedAccount && !hasDefaultPaymentMethod) {\r\n                $paypalAccountSave.checked = true;\r\n            } else {\r\n                $paypalAccountSaveContainer.style.display = 'none';\r\n            }\r\n            saveCheckboxState();\r\n        }\r\n        var isDataSetDefault = $selectedAccount.dataset.default === 'false' || $selectedAccount.dataset.default === 'null';\r\n        if (isDataSetDefault && !($selectedAccount.value === 'newaccount') && !isSessionAccountAppended) {\r\n            $paypalAccountMakeDefaultContainer.style.display = 'block';\r\n            $paypalAccountSaveContainer.style.display = 'none';\r\n            $paypalAccountSave.checked = false;\r\n            $paypalAccountMakeDefault.disabled = false;\r\n        }\r\n\r\n        if ($selectedAccount.value === 'newaccount' || isSessionAccountAppended) {\r\n            if (!hasPPSavedAccount) {\r\n                $paypalAccountMakeDefaultContainer.style.display = 'none';\r\n                $paypalAccountMakeDefault.checked = true;\r\n                $paypalAccountMakeDefault.disabled = false;\r\n                $paypalAccountSaveContainer.style.display = 'block';\r\n                if (($selectedAccount.value !== 'newaccount' && (hasDefaultPaymentMethod || isSessionAccountAppended)) ||\r\n                    ($selectedAccount.value === 'newaccount' && !isSessionAccountAppended)) {\r\n                    $paypalAccountSave.checked = true;\r\n                } else {\r\n                    $paypalAccountSave.checked = false;\r\n                }\r\n\r\n                saveCheckboxState();\r\n                return;\r\n            }\r\n            handleCheckboxChange();\r\n\r\n            if (isBALimitReached) {\r\n                $paypalAccountSaveContainer.style.display = 'none';\r\n                $paypalAccountMakeDefaultContainer.style.display = 'none';\r\n            } else {\r\n                $paypalAccountSaveContainer.style.display = 'block';\r\n                $paypalAccountMakeDefaultContainer.style.display = 'block';\r\n            }\r\n\r\n            if (hasDefaultPaymentMethod) {\r\n                return;\r\n            }\r\n            hasPPSavedAccount && !hasDefaultPaymentMethod ?\r\n                $paypalAccountMakeDefaultContainer.style.display = 'none' :\r\n                $paypalAccountMakeDefault.disabled = true;\r\n\r\n            $paypalAccountMakeDefault.checked = true;\r\n        }\r\n    }\r\n}\r\n\r\n/** Show billing agreement btn - hide paypal btn and vise versa\r\n*/\r\nfunction toggleBABtnVisibility() {\r\n    toggleCustomCheckbox();\r\n\r\n    if (isNewAccountSelected($restPaypalAccountsList)) {\r\n        showPaypalBABtn();\r\n        hideContinueButton();\r\n        return;\r\n    }\r\n    hidePaypalBABtn();\r\n    showPaypalBlock();\r\n}\r\n\r\n/** Assign billing agreement emails on change into input field\r\n*/\r\nfunction assignEmailForSavedBA() {\r\n    let $paypalActiveAccount = document.querySelector('#paypal_activeAccount');\r\n    let $selectedAccount = $restPaypalAccountsList.querySelector('option:checked');\r\n\r\n    if (isNewAccountSelected($restPaypalAccountsList)) {\r\n        $paypalActiveAccount.value = '';\r\n        document.getElementById('billingAgreementID').value = '';\r\n        document.getElementById('billingAgreementPayerEmail').value = '';\r\n    } else {\r\n        $paypalActiveAccount.value = $restPaypalAccountsList.querySelector('option:checked').value;\r\n\r\n        setBAFormValues($selectedAccount.dataset.baId, $selectedAccount.value);\r\n    }\r\n}\r\n\r\n/**\r\n *  Clear element to an Existing restPaypalAccountsList Collection\r\n *\r\n */\r\nfunction clearSessionOption() {\r\n    var $option = document.querySelector('#sessionPaypalAccount');\r\n    $option.text = '';\r\n    $option.value = '';\r\n    $option.setAttribute('data-append', false);\r\n    $option.selected = false;\r\n    $option.style.display = 'none';\r\n    $option.setAttribute('data-ba-id', '');\r\n    document.getElementById('billingAgreementID').value = '';\r\n    document.getElementById('billingAgreementPayerEmail').value = '';\r\n\r\n    toggleBABtnVisibility();\r\n}\r\n\r\n/**\r\n *  Update element under restPaypalAccountsList Collection\r\n *\r\n * @param {string} email - billing agreement email\r\n */\r\nfunction updateSessionOption(email) {\r\n    var $option = document.querySelector('#sessionPaypalAccount');\r\n    $option.text = email;\r\n    $option.value = email;\r\n    $option.selected = 'selected';\r\n    $option.style.display = 'block';\r\n    $option.setAttribute('data-append', true);\r\n    document.querySelector('#restPaypalAccountsList').value = email;\r\n\r\n    hidePaypalBABtn();\r\n    showPaypalBlock();\r\n    showContinueButton();\r\n}\r\n\r\nexport {\r\n    toggleBABtnVisibility,\r\n    assignEmailForSavedBA,\r\n    handleCheckboxChange,\r\n    clearSessionOption,\r\n    updateSessionOption,\r\n    setBAFormValues\r\n};\r\n","/* eslint-disable no-useless-escape */\r\n/* eslint-disable no-control-regex */\r\nimport { getBillingAgreementToken, createBillingAgreementCall, showCheckoutErrorHtml } from '../../api';\r\nimport { clearSessionOption, updateSessionOption, setBAFormValues } from './billingAgreementHelper';\r\nimport { getPaypalButtonStyle } from '../../helper';\r\n\r\nconst loaderInstance = require('../../loader');\r\nlet $loaderContainer = document.querySelector('.paypalLoader');\r\nlet loader = loaderInstance($loaderContainer);\r\n\r\n/**\r\n *  Create's Billing Agreement\r\n *\r\n * @returns {string} returns JSON response that includes an data token\r\n */\r\nfunction createBillingAgreement() {\r\n    loader.show();\r\n    return getBillingAgreementToken()\r\n        .then((data) => data.token)\r\n        .fail(() => {\r\n            loader.hide();\r\n        });\r\n}\r\n\r\n/**\r\n *  Makes post call using facilitator Access Token and transfers billingToken\r\n *  save's billingAgreementID & billingAgreementPayerEmail to input field\r\n *  and triggers checkout place order stage\r\n *\r\n * @param {string} billingToken - billing agreement token\r\n * @returns {Object} JSON response that includes the billing agreement ID and information about the payer\r\n */\r\nfunction onApprove({ billingToken }) {\r\n    return createBillingAgreementCall(billingToken)\r\n        .then(({ id, payer }) => {\r\n            let payerInfo = payer.payer_info;\r\n            let billingAddress = payerInfo.billing_address;\r\n            let $restPaypalAccountsList = document.querySelector('#restPaypalAccountsList');\r\n            let hasDefaultPaymentMethod = JSON.parse($restPaypalAccountsList.getAttribute('data-has-default-account'));\r\n            let hasPPSavedAccount = JSON.parse($restPaypalAccountsList.getAttribute('data-has-saved-account'));\r\n            document.querySelector('#sessionPaypalAccount').setAttribute('data-ba-id', id);\r\n            setBAFormValues(id, payerInfo.email);\r\n\r\n            if (hasDefaultPaymentMethod && !hasPPSavedAccount) {\r\n                $restPaypalAccountsList.setAttribute('data-has-default-account', false);\r\n                $('#restPaypalAccountsList').data('data-has-default-account', false); // MFRA jquery hack\r\n            }\r\n\r\n            let billingAddressFields = [];\r\n            let contactInfoFields = [].slice.call(document.querySelectorAll('.contact-info-block input[required]'));\r\n\r\n            var keysValues = {\r\n                email: payerInfo.email,\r\n                phoneNumber: payerInfo.phone,\r\n                billingFirstName: payerInfo.first_name,\r\n                billingLastName: payerInfo.last_name,\r\n                billingAddressOne: billingAddress.line1,\r\n                billingCountry: billingAddress.country_code,\r\n                billingState: billingAddress.state,\r\n                billingAddressCity: billingAddress.city,\r\n                billingZipCode: billingAddress.postal_code\r\n            };\r\n            let $billinAddressBlock = document.querySelector('.billing-address-block');\r\n            if ($billinAddressBlock.querySelector('#billingAddressSelector option:checked').value === 'new') {\r\n                billingAddressFields = [].slice.call($billinAddressBlock.querySelectorAll('input[required], select[required]'));\r\n            }\r\n\r\n            (contactInfoFields.concat(billingAddressFields)\r\n                .filter(el => el.value.trim() === ''))\r\n                .forEach(function (el) {\r\n                    el.value = keysValues[el.id];\r\n                });\r\n\r\n            document.querySelector('button.submit-payment').click();\r\n            var sameAttribute = [].slice.call($restPaypalAccountsList.options)\r\n                    .find(el => el.value === payerInfo.email);\r\n\r\n            (sameAttribute && sameAttribute.id !== 'sessionPaypalAccount') ?\r\n                clearSessionOption() :\r\n                updateSessionOption(payerInfo.email);\r\n\r\n            loader.hide();\r\n        })\r\n        .fail(() => {\r\n            loader.hide();\r\n        });\r\n}\r\n\r\n/**\r\n * Hides loader on paypal widget closing without errors\r\n\r\n */\r\nfunction onCancel() {\r\n    loader.hide();\r\n}\r\n\r\n/**\r\n * Shows errors if paypal widget was closed with errors\r\n *\r\n */\r\nfunction onError() {\r\n    loader.hide();\r\n    showCheckoutErrorHtml('An internal server error has occurred. \\r\\nRetry the request later.');\r\n}\r\n\r\n/**\r\n *Inits paypal Billing Agreement button on billing checkout page\r\n */\r\nfunction initPaypalBAButton() {\r\n    loader.show();\r\n    window.paypal.Buttons({\r\n        createBillingAgreement,\r\n        onApprove,\r\n        onCancel,\r\n        onError,\r\n        style: getPaypalButtonStyle(document.querySelector('.paypal-checkout-ba-button'))\r\n    }).render('.paypal-checkout-ba-button')\r\n        .then(() => {\r\n            loader.hide();\r\n        });\r\n}\r\n\r\nexport default initPaypalBAButton;\r\n","const defaultStyle = {\r\n    color: 'gold',\r\n    shape: 'rect',\r\n    layout: 'vertical',\r\n    label: 'paypal',\r\n    tagline: false\r\n};\r\n\r\n/**\r\n *  Gets paypal button styles\r\n * @param {Element} button - button element\r\n * @returns {Object} with button styles or if error appears with default styles\r\n */\r\nfunction getPaypalButtonStyle(button) {\r\n    try {\r\n        const config = button.getAttribute('data-paypal-button-config');\r\n        if (config) {\r\n            const buttonConfigs = JSON.parse(config);\r\n            return buttonConfigs.style;\r\n        }\r\n    } catch (error) {\r\n        return {\r\n            style: defaultStyle\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Creates a redirecting form to Order-Confirm endpoint\r\n * @param {Object} param  The helping object for creating a from\r\n * @returns {Object} form element\r\n */\r\nfunction createConfirmForm(param) {\r\n    var form = $('<form>')\r\n        .appendTo(document.body)\r\n        .attr({\r\n            method: 'POST',\r\n            action: param.url\r\n        });\r\n\r\n    $('<input>')\r\n        .appendTo(form)\r\n        .attr({\r\n            name: 'orderID',\r\n            value: param.orderID\r\n        });\r\n\r\n    $('<input>')\r\n        .appendTo(form)\r\n        .attr({\r\n            name: 'orderToken',\r\n            value: param.orderToken\r\n        });\r\n\r\n    return form;\r\n}\r\n\r\n/**\r\n * Prepare and submits form in order to confirm order with Lpm\r\n * @param {string} redirectUrl Redirect Url\r\n */\r\nfunction processLpmConfirmForm(redirectUrl) {\r\n    var splitUrl = redirectUrl.split('?');\r\n    var url = splitUrl[0];\r\n    var paramsString = splitUrl[1];\r\n    var searchParams = new URLSearchParams(paramsString);\r\n    var formParam = {\r\n        orderID: searchParams.get('orderID'),\r\n        orderToken: searchParams.get('orderToken'),\r\n        url: url\r\n    };\r\n    var form = createConfirmForm(formParam);\r\n\r\n    form.submit();\r\n}\r\n\r\nexport {\r\n    getPaypalButtonStyle,\r\n    processLpmConfirmForm\r\n};\r\n","/* eslint-disable require-jsdoc */\r\nmodule.exports = function (containerElement) {\r\n    function Constructor() {\r\n        this.containerEl = containerElement;\r\n    }\r\n    Constructor.prototype.show = function () {\r\n        this.containerEl.style.display = 'block';\r\n    };\r\n    Constructor.prototype.hide = function () {\r\n        this.containerEl.style.display = 'none';\r\n    };\r\n    return new Constructor();\r\n};\r\n"],"sourceRoot":""}