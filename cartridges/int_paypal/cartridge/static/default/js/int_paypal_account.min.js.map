{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./cartridges/int_paypal/cartridge/client/default/js/account/account.js","webpack:///./cartridges/int_paypal/cartridge/client/default/js/account/initBillingAgreementButton.js","webpack:///./cartridges/int_paypal/cartridge/client/default/js/api.js","webpack:///./cartridges/int_paypal/cartridge/client/default/js/loader.js"],"names":["loaderInstance","require","$loaderContainer","document","querySelector","loader","$paypalAccountBtn","$addNewAccountBtn","$paypalBlock","$limitMsg","paypalUrls","getAttribute","window","JSON","parse","isBaLimitReached","onclick","paypal","innerHTML","initPaypalBAButton","style","display","e","target","classList","contains","baEmail","dataset","billingAgreementEmail","show","$","ajax","url","removeBillingAgreement","type","then","hide","location","reload","fail","createBillingAgreement","isCartFlow","getBillingAgreementToken","data","token","onApprove","billingToken","createBillingAgreementCall","id","payer","email","payer_info","saveBillingAgreement","contentType","stringify","baID","onCancel","onError","Buttons","render","showCartErrorHtml","message","addClass","append","scrollTo","showCheckoutErrorHtml","textContent","updateOrderData","success","href","placeOrderStage","error","err","responseText","errorMsg","transactionExpired","getPurchaseUnits","get","getPurchaseUnit","purchase_units","createBillingAgreementToken","createCartBillingFormData","fieldsData","$paypalButton","cartBillingFormData","FormData","cartBillingFields","Object","entries","forEach","entry","key","field","name","value","returnFromCart","processData","finishLpmOrder","details","lpmName","paypalMethodId","module","exports","containerElement","Constructor","containerEl","prototype"],"mappings":"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","file":"int_paypal_account.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./cartridges/int_paypal/cartridge/client/default/js/account/account.js\");\n","import initPaypalBAButton from './initBillingAgreementButton';\r\n\r\nconst loaderInstance = require('../loader');\r\nlet $loaderContainer = document.querySelector('.paypalLoader');\r\nlet loader = loaderInstance($loaderContainer);\r\n\r\nlet $paypalAccountBtn = document.querySelector('.paypal-account-button');\r\nlet $addNewAccountBtn = document.querySelector('.add-paypal-account');\r\nlet $paypalBlock = document.querySelector('.paypal-block');\r\nlet $limitMsg = document.querySelector('.limitMsg');\r\nconst paypalUrls = $paypalAccountBtn && $paypalAccountBtn.getAttribute('data-paypal-urls');\r\nwindow.paypalUrls = JSON.parse(paypalUrls);\r\n\r\n\r\nif ($addNewAccountBtn && $paypalAccountBtn) {\r\n    let isBaLimitReached = JSON.parse($paypalAccountBtn.getAttribute('data-paypal-is-ba-limit-reached'));\r\n    $addNewAccountBtn.onclick = function () {\r\n        if (window.paypal && $paypalAccountBtn.innerHTML === '' && !isBaLimitReached) {\r\n            initPaypalBAButton();\r\n        } else if (isBaLimitReached) {\r\n            $limitMsg.style.display = 'block';\r\n        }\r\n    };\r\n}\r\n\r\nif ($paypalBlock) {\r\n    $paypalBlock.onclick = function (e) {\r\n        let target = e.target;\r\n        if (target.classList.contains('remove-paypal-button')) {\r\n            let baEmail = target.dataset.billingAgreementEmail;\r\n            loader.show();\r\n            return $.ajax({\r\n                url: window.paypalUrls.removeBillingAgreement + `?billingAgreementEmail=${baEmail}`,\r\n                type: 'DELETE'\r\n            })\r\n                .then(() => {\r\n                    loader.hide();\r\n                    location.reload();\r\n                })\r\n                .fail(() => {\r\n                    loader.hide();\r\n                });\r\n        }\r\n    };\r\n}\r\n","import { getBillingAgreementToken, createBillingAgreementCall } from '../api';\r\n\r\nconst loaderInstance = require('../loader');\r\nlet $loaderContainer = document.querySelector('.paypalLoader');\r\nlet loader = loaderInstance($loaderContainer);\r\n\r\n/**\r\n *  Creates Billing Agreement\r\n *\r\n * @returns {string} returns JSON response that includes an data token\r\n */\r\nfunction createBillingAgreement() {\r\n    loader.show();\r\n    let isCartFlow = true;\r\n    return getBillingAgreementToken(isCartFlow)\r\n        .then((data) => data.token)\r\n        .fail(() => {\r\n            loader.hide();\r\n        });\r\n}\r\n\r\n/**\r\n *  Makes post call using facilitator Access Token and transfers billingToken\r\n *  send baID & email to saveBillingAgreement endpoint\r\n *\r\n * @param {string} billingToken - billing agreement token\r\n * @returns {Object} JSON response that includes the billing agreement ID and information about the payer\r\n */\r\nfunction onApprove({ billingToken }) {\r\n    return createBillingAgreementCall(billingToken)\r\n        .then(({ id, payer }) => {\r\n            let email = payer.payer_info.email;\r\n            return $.ajax({\r\n                url: window.paypalUrls.saveBillingAgreement,\r\n                type: 'POST',\r\n                contentType: 'application/json',\r\n                data: JSON.stringify({ baID: id, email })\r\n            });\r\n        })\r\n        .then(() => {\r\n            loader.hide();\r\n            location.reload();\r\n        })\r\n        .fail(() => {\r\n            loader.hide();\r\n        });\r\n}\r\n\r\n/**\r\n * Hides loader on paypal widget closing without errors\r\n\r\n */\r\nfunction onCancel() {\r\n    loader.hide();\r\n}\r\n\r\n/**\r\n * Shows errors if paypal widget was closed with errors\r\n *\r\n */\r\nfunction onError() {\r\n    loader.hide();\r\n}\r\n\r\n/**\r\n *Inits paypal Billing Agreement button on billing checkout page\r\n */\r\nfunction initPaypalBAButton() {\r\n    loader.show();\r\n    window.paypal.Buttons({\r\n        createBillingAgreement,\r\n        onApprove,\r\n        onCancel,\r\n        onError\r\n    }).render('.paypal-account-button')\r\n        .then(() => {\r\n            loader.hide();\r\n        });\r\n}\r\n\r\nexport default initPaypalBAButton;\r\n","var loaderInstance = require('./loader');\r\nvar $loaderContainer = document.querySelector('.paypalLoader');\r\nvar loader = loaderInstance($loaderContainer);\r\n/**\r\n *  Appends error message on cart page\r\n *\r\n * @param {string} message error message\r\n */\r\nfunction showCartErrorHtml(message) {\r\n    $('.checkout-btn').addClass('disabled');\r\n    $('.cart-error').append(\r\n        `<div class=\"alert alert-danger alert-dismissible valid-cart-error fade show cartError\" role=\"alert\">\r\n            <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">\r\n                <span aria-hidden=\"true\">&times;</span>\r\n            </button>\r\n            ${message}\r\n        </div>`\r\n    );\r\n    window.scrollTo(0, 0);\r\n}\r\n\r\n/**\r\n *  Appends error message on billing checkout page\r\n *\r\n * @param {string} message error message\r\n */\r\nfunction showCheckoutErrorHtml(message) {\r\n    document.querySelector('.error-message-text').textContent = '';\r\n    document.querySelector('.error-message').style.display = 'block';\r\n    document.querySelector('.error-message-text').append(message);\r\n    window.scrollTo(0, 0);\r\n}\r\n\r\n/**\r\n * Updates information about an order\r\n *\r\n * @returns {Object} Call handling result\r\n */\r\nfunction updateOrderData() {\r\n    loader.show();\r\n    return $.ajax({\r\n        url: window.paypalUrls.updateOrderData + '?isCartFlow=true',\r\n        type: 'PATCH',\r\n        success: () => {\r\n            loader.hide();\r\n            window.location.href = window.paypalUrls.placeOrderStage;\r\n        },\r\n        error: (err) => {\r\n            loader.hide();\r\n            var error = JSON.parse(err.responseText);\r\n            showCartErrorHtml(error.errorMsg);\r\n            if (error.transactionExpired) {\r\n                location.reload();\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Gets purchase units\r\n *\r\n * @returns {Object} with purchase units data\r\n */\r\nfunction getPurchaseUnits() {\r\n    return $.get(window.paypalUrls.getPurchaseUnit)\r\n        .then(({ purchase_units }) => purchase_units);\r\n}\r\n\r\n/**\r\n * Gets Billing Agreement Token\r\n *\r\n * @param {boolean} isCartFlow - billing agreement flow from cart\r\n * @returns {string} billingToken - returns a JSON response that includes token, an approval URL\r\n */\r\nfunction getBillingAgreementToken(isCartFlow = false) {\r\n    return $.get(window.paypalUrls.createBillingAgreementToken + `?isCartFlow=${isCartFlow}`)\r\n        .then((data) => data);\r\n}\r\n\r\n/**\r\n * Gets Billing Agreement\r\n * After buyer approval, you use a billing agreement token to create the agreement.\r\n *\r\n * @param {string} billingToken - billing agreement token\r\n * @returns {Object} JSON response body that includes the billing agreement ID,\r\n * the state of the agreement, which is ACTIVE, and information about the payer\r\n */\r\nfunction createBillingAgreementCall(billingToken) {\r\n    return $.ajax({\r\n        url: window.paypalUrls.createBillingAgreement,\r\n        type: 'POST',\r\n        contentType: 'application/json',\r\n        data: JSON.stringify({ billingToken })\r\n    });\r\n}\r\n\r\n/**\r\n * Create billing formData from fields data\r\n *\r\n * @param {Object} fieldsData - fields data values\r\n * @param {Elemtn} $paypalButton - paypal button selector\r\n * @returns {Object} cart billing form data\r\n */\r\nfunction createCartBillingFormData(fieldsData, $paypalButton) {\r\n    var cartBillingFormData = new FormData();\r\n    if (!$paypalButton) {\r\n        $paypalButton = document.querySelector('#paypal_pdp_image') || document.querySelector('#paypal_image') || document.querySelector('#venmo_image');\r\n    }\r\n    var cartBillingFields = $paypalButton && JSON.parse($paypalButton.getAttribute('data-paypal-billing-form-fields'));\r\n\r\n    Object.entries(cartBillingFields).forEach(entry => {\r\n        const [key, field] = entry;\r\n        if (typeof field === 'object') {\r\n            cartBillingFormData.append(field.name, fieldsData && fieldsData[key] ? fieldsData[key] : field.value);\r\n        }\r\n    });\r\n\r\n    return cartBillingFormData;\r\n}\r\n\r\n/**\r\n * Calls to returnFromCart endpoint, redirects to place order stage or shows error if it exists\r\n *\r\n * @returns {Object} Call handling result\r\n */\r\nfunction returnFromCart() {\r\n    loader.show();\r\n    let cartBillingFormData = createCartBillingFormData();\r\n\r\n    return $.ajax({\r\n        url: window.paypalUrls.returnFromCart,\r\n        type: 'POST',\r\n        contentType: false,\r\n        data: cartBillingFormData,\r\n        processData: false,\r\n        success: () => {\r\n            loader.hide();\r\n            window.location.href = window.paypalUrls.placeOrderStage;\r\n        },\r\n        error: function (err) {\r\n            loader.hide();\r\n            showCartErrorHtml(err.responseText);\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Call finishLpmOrder endpoint\r\n * @param  {Object} details billing address details\r\n * @returns {Promise} ajax call\r\n */\r\nfunction finishLpmOrder(details) {\r\n    const lpmName = document.querySelector('#usedPaymentMethod').value;\r\n    const paypalMethodId = document.querySelector('#paypalMethodId').value;\r\n    return $.ajax({\r\n        url: window.paypalUrls.finishLpmOrder,\r\n        type: 'POST',\r\n        contentType: 'application/json',\r\n        data: JSON.stringify({\r\n            details,\r\n            lpmName,\r\n            paypalMethodId\r\n        })\r\n    });\r\n}\r\n\r\nexport {\r\n    updateOrderData,\r\n    getPurchaseUnits,\r\n    getBillingAgreementToken,\r\n    createBillingAgreementCall,\r\n    returnFromCart,\r\n    showCartErrorHtml,\r\n    showCheckoutErrorHtml,\r\n    finishLpmOrder,\r\n    createCartBillingFormData\r\n};\r\n","/* eslint-disable require-jsdoc */\r\nmodule.exports = function (containerElement) {\r\n    function Constructor() {\r\n        this.containerEl = containerElement;\r\n    }\r\n    Constructor.prototype.show = function () {\r\n        this.containerEl.style.display = 'block';\r\n    };\r\n    Constructor.prototype.hide = function () {\r\n        this.containerEl.style.display = 'none';\r\n    };\r\n    return new Constructor();\r\n};\r\n"],"sourceRoot":""}